import{q as j,d as h,b as m,z as d,s as u,f,g as p,j as e,A as D,R as x,B as a,m as C,S as b,t as q,p as Q}from"./index-C942lwoZ.js";import{F as N,C as v}from"./dashboard-CQ0oUUA2.js";import{P as L,T as R,g as S,a as w}from"./get-discussion-B2n3eVHP.js";import{F,I,T}from"./login-b1Lb-HGX.js";import{T as z}from"./users-BGrw7aNf.js";import{C as A,f as B}from"./confirmation-dialog-C7VX5uS8.js";const P=(s=1)=>m.get("/discussions",{params:{page:s}}),c=({page:s}={})=>j({queryKey:s?["discussions",{page:s}]:["discussions"],queryFn:()=>P(s)}),K=({queryConfig:s,page:i})=>h({...c({page:i}),...s}),M=d.object({title:d.string().min(1,"Required"),body:d.string().min(1,"Required")}),O=({data:s})=>m.post("/discussions",s),E=({mutationConfig:s}={})=>{const i=u(),{onSuccess:t,...n}=s||{};return f({onSuccess:(...r)=>{i.invalidateQueries({queryKey:c().queryKey}),t==null||t(...r)},...n,mutationFn:O})},k=()=>{const{addNotification:s}=p(),i=E({mutationConfig:{onSuccess:()=>{s({type:"success",title:"Discussion Created"})}}});return e.jsx(D,{allowedRoles:[x.ADMIN],children:e.jsx(N,{isDone:i.isSuccess,triggerButton:e.jsx(a,{size:"sm",icon:e.jsx(L,{className:"size-4"}),children:"Create Discussion"}),title:"Create Discussion",submitButton:e.jsx(a,{form:"create-discussion",type:"submit",size:"sm",isLoading:i.isPending,children:"Submit"}),children:e.jsx(F,{id:"create-discussion",onSubmit:t=>{i.mutate({data:t})},schema:M,children:({register:t,formState:n})=>e.jsxs(e.Fragment,{children:[e.jsx(I,{label:"Title",error:n.errors.title,registration:t("title")}),e.jsx(T,{label:"Body",error:n.errors.body,registration:t("body")})]})})})})},U=({discussionId:s})=>m.delete(`/discussions/${s}`),H=({mutationConfig:s}={})=>{const i=u(),{onSuccess:t,...n}=s||{};return f({onSuccess:(...r)=>{i.invalidateQueries({queryKey:c().queryKey}),t==null||t(...r)},...n,mutationFn:U})},V=({id:s})=>{const{addNotification:i}=p(),t=H({mutationConfig:{onSuccess:()=>{i({type:"success",title:"Discussion Deleted"})}}});return e.jsx(D,{allowedRoles:[x.ADMIN],children:e.jsx(A,{icon:"danger",title:"Delete Discussion",body:"Are you sure you want to delete this discussion?",triggerButton:e.jsx(a,{variant:"destructive",icon:e.jsx(R,{className:"size-4"}),children:"Delete Discussion"}),confirmButton:e.jsx(a,{isLoading:t.isPending,type:"button",variant:"destructive",onClick:()=>t.mutate({discussionId:s}),children:"Delete Discussion"})})})},$=({onDiscussionPrefetch:s})=>{var y,g;const[i]=C(),t=K({page:+(i.get("page")||1)}),n=u();if(t.isLoading)return e.jsx("div",{className:"flex h-48 w-full items-center justify-center",children:e.jsx(b,{size:"lg"})});const r=(y=t.data)==null?void 0:y.data,l=(g=t.data)==null?void 0:g.meta;return r?e.jsx(z,{data:r,columns:[{title:"Title",field:"title"},{title:"Created At",field:"createdAt",Cell({entry:{createdAt:o}}){return e.jsx("span",{children:B(o)})}},{title:"",field:"id",Cell({entry:{id:o}}){return e.jsx(q,{onMouseEnter:()=>{n.prefetchQuery(S(o)),s==null||s(o)},to:Q.app.discussion.getHref(o),children:"View"})}},{title:"",field:"id",Cell({entry:{id:o}}){return e.jsx(V,{id:o})}}],pagination:l&&{totalPages:l.totalPages,currentPage:l.page,rootUrl:""}}):null},_=s=>async({request:i})=>{const t=new URL(i.url),n=Number(t.searchParams.get("page")||1),r=c({page:n});return s.getQueryData(r.queryKey)??await s.fetchQuery(r)},ss=()=>{const s=u();return e.jsxs(v,{title:"Discussions",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(k,{})}),e.jsx("div",{className:"mt-4",children:e.jsx($,{onDiscussionPrefetch:i=>{s.prefetchInfiniteQuery(w(i))}})})]})};export{_ as clientLoader,ss as default};
